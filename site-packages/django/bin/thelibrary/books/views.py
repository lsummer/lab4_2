from django.shortcuts import render_to_response,HttpResponse
from books.models import Book, Author

# Create your views here.

def books_insert(request):
   # try:
    if request.POST:
        post=request.POST
        newbook=Book(
            title = post["title"],
            authors_id = Author.objects.get(name=post["name"]).id,
            publisher = post["publisher"],
            publishdate = post["publishdate"],
            price = post["price"])
        newbook.save()
    return render_to_response("books_insert.html")   
    #except:
       # return render_to_response("author_insert.html")      

    
def author_insert(request):    
    if request.POST:
        post=request.POST
        newauthor = Author(
             name = post["name"],
             age = post["age"],  
             country = post["country"])
        newauthor.save()
    return render_to_response("author_insert.html")  
    
def search_books(request):
    if 'search_name' in request.GET and Author.objects.filter(name=request.GET['search_name']):
        authorid = Author.objects.get(name=request.GET['search_name']).id
        book_list = Book.objects.filter(authors=authorid)       
        return render_to_response('search_books.html', {'book_list':book_list})
    else:
        return HttpResponse('please submit a seach term')
        
def search(request):
    return render_to_response("search.html")  

def Delete(request):
    get_id = request.GET["id"]
    Book.objects.get(id=get_id).delete()
    Book.objects.all()
    return render_to_response("delete.html")
    
def main(requset):
    return render_to_response("main.html")
    
def update(request):  
    get_id = request.GET["id"]
    book1 = Book.objects.get(id=get_id)
    if request.POST:        
        post = request.POST        
        book1.authors_id = Author.objects.get(name=post["name"]).id
        book1.publisher = post["publisher"]
        book1.publishdate = post["publishdate"]
        book1.price = post["price"] 
        book1.save()
        #book1.objects.all()
        return render_to_response("author_insert.html")  
    return render_to_response("update.html", {'book':book1}) 
